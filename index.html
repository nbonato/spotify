<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="fonts/fonts.css">
    <title>Salento, ma anche molto veloce</title>
</head>
<body>   
    <h1>Madre mia, ma chi ha messo 'sta cagata?</h1>
    <form id="song-form">
        <input id="input-box" list="songs" placeholder="Scopriamolo!"> 
        <input type="button" onclick="newFunction()" value="Reset">
        <datalist id="songs">
        </datalist>
    </form>
    

    <p></p>

<script>
    var dataList = document.getElementById('songs');
    const para = document.querySelector('p');
    const input = document.getElementById("input-box");
    var titles = [];

    var jsonOptions;

    const getData = async () => {
        const response = await fetch("songs.json");
        const data = await response.json();
        jsonOptions = data;
        return data;
    };
    function newFunction() {
            document.getElementById("song-form").reset();
            para.textContent = "";
         }
    (async () => {
        await getData();
        console.log(jsonOptions);
            // Loop over the JSON array.
        jsonOptions.forEach(function(item) {
            var option = document.createElement('option');
            titles.push(item.title);
            option.value = item.title;
            option.id = item.id;
            option.dataset.author = item.author;
            option.dataset.contributor = item.contributor;
            dataList.appendChild(option);

        });
        input.addEventListener("input", () => {
            if (titles.includes(input.value)) {                
                var option = Array.prototype.find.call(input.list.options, function(option) {
                    return option.value === input.value;
                });
                let contributor = option.getAttribute('data-contributor');
                para.textContent = `La canzone Ã¨ stata inserita da ${contributor}`;
                console.log(document.querySelector("option").value);
            }
        })
        
    })();


</script>

</body>
</html>
